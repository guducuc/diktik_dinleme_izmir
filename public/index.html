<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dikotik Dinleme Izmir</title>

  <meta name="emailjs-user"    content="FLn2zMqKDGso3ePoO">
  <meta name="emailjs-service" content="service_a8bnfmk">
  <meta name="emailjs-template"content="template_7elc4wi">

  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:12px;color:#111}
    h1{font-size:20px;margin-bottom:8px}
    .hidden{display:none}
    .card{padding:12px;border:1px solid #ddd;border-radius:8px;margin-bottom:12px}
    input[type=text], input[type=number], select{padding:8px;margin:6px 0;width:100% ;box-sizing:border-box}
    .respRow{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .respBtn{
      font-size:2rem;
      padding:18px 26px;
      margin:6px;
      min-width:120px;
      border-radius:10px;
      border:1px solid #444;
      background:#f2f2f2;
      cursor:pointer;
      transition:background-color 0.2s;
    }
    .respBtn-active {
        background-color: #bdbdbd;
    }
    #warning{color:#8b0000;font-weight:600}
    .small{font-size:13px;color:#666}
    .question-group {margin-bottom: 12px;}
    .radio-label { display: block; margin-bottom: 4px; }
  </style>
</head>
<body>
  <h1>Dikotik Dinleme Izmir</h1>

  <!-- Katılımcı bilgileri -->
  <div id="participantCard" class="card">
    <h3>Katılımcı Bilgileri</h3>
    <div><input id="name" placeholder="Ad"></div>
    <div><input id="surname" placeholder="Soyad"></div>
    <div><input id="age" type="number" placeholder="Yaş"></div>
    <div><input id="race" placeholder="Irk"></div>
    <div><input id="motherTongue" placeholder="Anadil"></div>
    <div>
      <select id="gender">
        <option value="">Cinsiyet seçin</option>
        <option value="Kadın">Kadın</option>
        <option value="Erkek">Erkek</option>
        <option value="Diğer">Diğer</option>
      </select>
    </div>
    <div style="margin-top:8px"><button id="toStaiBtn">Devam</button></div>
    <div id="codeInfo" class="small" style="margin-top:8px"></div>
  </div>

  <!-- STAI Form -->
  <div id="staiTxiCard" class="card hidden">
    <h3>STAI-TXI Formu</h3>
    <p class="small">Aşağıdaki soruları yanıtlayınız. Tümünü işaretlemeden devam edemezsiniz.</p>
    <div id="staiQuestions"></div>
    <div style="margin-top:10px"><button id="toHandednessBtn">Devam</button></div>
  </div>

  <!-- El Kullanımı -->
  <div id="handUseCard" class="card hidden">
    <h3>El Kullanımı Testi</h3>
    <p class="small">Her soruda en az bir kutucuk işaretleyiniz.</p>
    <div id="handUseQuestions"></div>
    <div style="margin-top:10px"><button id="toHearingRightBtn">Devam</button></div>
  </div>

  <!-- (geri kalan tüm kartlar senin son gönderdiğinle aynı kalıyor) -->

<script>
/* ================== State ================== */
let participant = {};
let results = [];
let currentTrial = -1;
let sessionOrder = [];
let currentSessionIndex = 0;
let rightLevel = 0.5, leftLevel = 0.5;
let trialTimeout = null;
let isResponseAllowed = false;

/* ================ STAI Soruları ================ */
const staiQuestions = [
    "Şu anda sakinim",
    "Kendimi emniyette hissediyorum",
    "Şu anda sinirlerim gergin",
    "Pişmanlık duygusu içindeyim",
    "Şu anda huzur içindeyim",
    "Şu anda hiç keyfim yok",
    "Başıma geleceklerden endişe ediyorum",
    "Kendimi dinlenmiş hissediyorum",
    "Şu anda kaygılıyım",
    "Kendimi rahat hissediyorum",
    "Kendime güvenim var",
    "Şu anda asabım bozuk",
    "Çok sinirliyim",
    "Sinirlerimin çok gergin olduğunu hissediyorum",
    "Kendimi rahatlamış hissediyorum",
    "Şu anda halimden memnunum",
    "Şu anda endişeliyim",
    "Heyecandan kendimi şaşkına dönmüş hissediyorum",
    "Şu anda sevinçliyim",
    "Şu anda keyfim yerinde"
];
function renderStaiTxiForm() {
    const container = document.getElementById('staiQuestions');
    container.innerHTML = '';
    staiQuestions.forEach((q, i) => {
        const questionHtml = `
            <div class="question-group">
                <p>${i + 1}. ${q}</p>
                <label><input type="radio" name="staiQ${i + 1}" value="1"> Hiç</label>
                <label><input type="radio" name="staiQ${i + 1}" value="2"> Biraz</label>
                <label><input type="radio" name="staiQ${i + 1}" value="3"> Çok</label>
                <label><input type="radio" name="staiQ${i + 1}" value="4"> Tamamıyla</label>
            </div>
        `;
        container.innerHTML += questionHtml;
    });
}

/* ================ El Kullanımı Soruları ================ */
const handUseQuestions = [
    "Yazmak",
    "Çizmek",
    "Taş Atmak",
    "Makas kullanmak",
    "Diş fırçası kullanmak",
    "Bıçak kullanmak",
    "Kaşık kullanmak",
    "Süpürge kullanmak (üst el)",
    "Kibrit çakmak",
    "Kutunun kapağını açmak"
];
function renderHandUseForm() {
    const container = document.getElementById('handUseQuestions');
    container.innerHTML = '';
    handUseQuestions.forEach((q, i) => {
        const questionId = `handQ${i + 1}`;
        const questionHtml = `
            <div class="question-group" data-question-id="${questionId}">
                <label>${i + 1}. ${q}</label>
                <input type="checkbox" class="left-option"> Sol
                <input type="checkbox" class="right-option"> Sağ
            </div>
        `;
        container.innerHTML += questionHtml;
    });
}

/* ================ Geçiş Kontrolleri ================= */
// STAI -> El Kullanımı
document.getElementById('toHandednessBtn').addEventListener('click', () => {
    let allAnswered = true;
    for (let i = 1; i <= staiQuestions.length; i++) {
        if (!document.querySelector(`input[name="staiQ${i}"]:checked`)) {
            allAnswered = false;
            break;
        }
    }
    if (!allAnswered) {
        alert("Lütfen tüm STAI sorularını yanıtlayın.");
        return;
    }
    document.getElementById('staiTxiCard').classList.add('hidden');
    document.getElementById('handUseCard').classList.remove('hidden');
    renderHandUseForm();
});

// El Kullanımı -> İşitme Testi
document.getElementById('toHearingRightBtn').addEventListener('click', () => {
    let allAnswered = true;
    document.querySelectorAll('#handUseQuestions .question-group').forEach(group => {
        const leftChecked = group.querySelector('.left-option').checked;
        const rightChecked = group.querySelector('.right-option').checked;
        if (!leftChecked && !rightChecked) {
            allAnswered = false;
        }
    });
    if (!allAnswered) {
        alert("Lütfen tüm El Kullanımı sorularını yanıtlayın.");
        return;
    }
    document.getElementById('handUseCard').classList.add('hidden');
    document.getElementById('hearingRightCard').classList.remove('hidden');
});
</script>
</body>
</html>
