<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dikotik Dinleme Izmir</title>

  <meta name="emailjs-user"    content="FLn2zMqKDGso3ePoO">
  <meta name="emailjs-service" content="service_a8bnfmk">
  <meta name="emailjs-template"content="template_7elc4wi">

  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:12px;color:#111}
    h1{font-size:20px;margin-bottom:8px}
    .hidden{display:none}
    .card{padding:12px;border:1px solid #ddd;border-radius:8px;margin-bottom:12px}
    input[type=text], input[type=number], select{padding:8px;margin:6px 0;width:100%;box-sizing:border-box}
    .respRow{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .respBtn{
      font-size:2rem;
      padding:18px 26px;
      margin:6px;
      min-width:120px;
      border-radius:10px;
      border:1px solid #444;
      background:#f2f2f2;
      cursor:pointer;
      transition:background-color 0.2s;
    }
    .respBtn-active {background-color:#bdbdbd}
    .small{font-size:13px;color:#666}
    .question-group{margin-bottom:12px}
  </style>
</head>
<body>
  <h1>Dikotik Dinleme Izmir</h1>

  <!-- Katılımcı Bilgileri -->
  <div id="participantCard" class="card">
    <h3>Katılımcı Bilgileri</h3>
    <input id="name" placeholder="Ad">
    <input id="surname" placeholder="Soyad">
    <input id="age" type="number" placeholder="Yaş">
    <input id="race" placeholder="Irk">
    <input id="motherTongue" placeholder="Anadil">
    <select id="gender">
      <option value="">Cinsiyet seçin</option>
      <option value="Kadın">Kadın</option>
      <option value="Erkek">Erkek</option>
      <option value="Diğer">Diğer</option>
    </select>
    <div style="margin-top:8px"><button id="toStaiBtn">Devam</button></div>
    <div id="codeInfo" class="small"></div>
  </div>

  <!-- STAI -->
  <div id="staiTxiCard" class="card hidden">
    <h3>STAI-TXI Formu</h3>
    <p class="small">Lütfen tüm soruları yanıtlayınız.</p>
    <div id="staiQuestions"></div>
    <button id="toHandednessBtn">Devam</button>
  </div>

  <!-- El Kullanımı -->
  <div id="handUseCard" class="card hidden">
    <h3>El Kullanımı Testi</h3>
    <p class="small">Her soruda en az bir kutucuk işaretleyiniz.</p>
    <div id="handUseQuestions"></div>
    <button id="toHearingRightBtn">Devam</button>
  </div>

  <!-- İşitme testleri, oturumlar, denemeler, bitiş kartı -->
  <!-- (Senin son sürümündeki kod burada devam ediyor) -->

<script>
// ================== Helpers ==================
function $id(i){return document.getElementById(i);}
function showWarning(msg){alert(msg);}

// Türkçe karakter temizleme
function trToEn(str){
  return str.replace(/Ğ/g,'G').replace(/ğ/g,'g')
            .replace(/İ/g,'I').replace(/ı/g,'i')
            .replace(/Ş/g,'S').replace(/ş/g,'s')
            .replace(/Ü/g,'U').replace(/ü/g,'u')
            .replace(/Ö/g,'O').replace(/ö/g,'o')
            .replace(/Ç/g,'C').replace(/ç/g,'c');
}

// ================== Katılımcı Kodu ==================
let participant={};
function makeParticipantCode(){
  const name=trToEn(($id('name').value||'').trim());
  const surname=trToEn(($id('surname').value||'').trim());
  const age=($id('age').value||'').trim();
  const gender=($id('gender').value||'').trim();
  const race=($id('race').value||'').trim();
  const motherTongue=($id('motherTongue').value||'').trim();

  if(!name||!surname||!age||!gender||!race||!motherTongue){return false;}

  participant.age=age;participant.gender=gender;
  participant.race=race;participant.motherTongue=motherTongue;

  const n2=(name.padEnd(2).slice(0,2)).toUpperCase();
  const s2=(surname.padEnd(2).slice(0,2)).toUpperCase();
  const four=(n2+s2).replace(/[^A-Z]/g,'X').slice(0,4);
  const rand5=Math.floor(10000+Math.random()*90000);
  const code=four+"_"+rand5;
  participant.code=code;
  $id('codeInfo').innerText="Katılımcı kodu: "+code;
  return true;
}

// ================== Sorular ==================
const staiQuestions=[
 "Şu anda sakinim","Kendimi emniyette hissediyorum","Şu anda sinirlerim gergin",
 "Pişmanlık duygusu içindeyim","Şu anda huzur içindeyim","Şu anda hiç keyfim yok",
 "Başıma geleceklerden endişe ediyorum","Kendimi dinlenmiş hissediyorum","Şu anda kaygılıyım",
 "Kendimi rahat hissediyorum","Kendime güvenim var","Şu anda asabım bozuk",
 "Çok sinirliyim","Sinirlerimin çok gergin olduğunu hissediyorum","Kendimi rahatlamış hissediyorum",
 "Şu anda halimden memnunum","Şu anda endişeliyim","Heyecandan kendimi şaşkına dönmüş hissediyorum",
 "Şu anda sevinçliyim","Şu anda keyfim yerinde"
];
function renderStaiTxiForm(){
  const c=$id('staiQuestions');c.innerHTML='';
  staiQuestions.forEach((q,i)=>{
    c.innerHTML+=`
    <div class="question-group">
      <p>${i+1}. ${q}</p>
      <label><input type="radio" name="staiQ${i+1}" value="1"> Hiç</label>
      <label><input type="radio" name="staiQ${i+1}" value="2"> Biraz</label>
      <label><input type="radio" name="staiQ${i+1}" value="3"> Çok</label>
      <label><input type="radio" name="staiQ${i+1}" value="4"> Tamamıyla</label>
    </div>`;
  });
}

const handUseQuestions=["Yazmak","Çizmek","Taş Atmak","Makas kullanmak","Diş fırçası kullanmak","Bıçak kullanmak","Kaşık kullanmak","Süpürge kullanmak (üst el)","Kibrit çakmak","Kutunun kapağını açmak"];
function renderHandUseForm(){
  const c=$id('handUseQuestions');c.innerHTML='';
  handUseQuestions.forEach((q,i)=>{
    c.innerHTML+=`
    <div class="question-group" data-question-id="handQ${i+1}">
      <label>${i+1}. ${q}</label>
      <input type="checkbox" class="left-option"> Sol
      <input type="checkbox" class="right-option"> Sağ
    </div>`;
  });
}

// ================== Geçiş Kontrolleri ==================

// Katılımcı -> STAI
$id('toStaiBtn').addEventListener('click',()=>{
  if(!makeParticipantCode()){alert("Lütfen tüm bilgileri doldurun.");return;}
  $id('participantCard').classList.add('hidden');
  $id('staiTxiCard').classList.remove('hidden');
  renderStaiTxiForm();
});

// STAI -> El Kullanımı
$id('toHandednessBtn').addEventListener('click',()=>{
  let allAnswered=true;
  for(let i=1;i<=staiQuestions.length;i++){
    if(!$(`input[name="staiQ${i}"]:checked`)){allAnswered=false;break;}
  }
  if(!allAnswered){alert("Lütfen tüm STAI sorularını yanıtlayın.");return;}
  const staiAnswers={};
  document.querySelectorAll('#staiQuestions input[type="radio"]:checked').forEach(inp=>{
    staiAnswers[inp.name]=inp.value;
  });
  participant.staiAnswers=staiAnswers;
  $id('staiTxiCard').classList.add('hidden');
  $id('handUseCard').classList.remove('hidden');
  renderHandUseForm();
});

// El Kullanımı -> İşitme Testi
$id('toHearingRightBtn').addEventListener('click',()=>{
  let allAnswered=true;
  document.querySelectorAll('#handUseQuestions .question-group').forEach(g=>{
    const l=g.querySelector('.left-option').checked;
    const r=g.querySelector('.right-option').checked;
    if(!l&&!r) allAnswered=false;
  });
  if(!allAnswered){alert("Lütfen tüm El Kullanımı sorularını yanıtlayın.");return;}
  const handUseAnswers={};
  document.querySelectorAll('#handUseQuestions .question-group').forEach(g=>{
    const id=g.dataset.questionId;
    const l=g.querySelector('.left-option').checked;
    const r=g.querySelector('.right-option').checked;
    if(l&&r)handUseAnswers[id]='both';
    else if(l)handUseAnswers[id]='left';
    else if(r)handUseAnswers[id]='right';
  });
  participant.handUseAnswers=handUseAnswers;
  $id('handUseCard').classList.add('hidden');
  $id('hearingRightCard').classList.remove('hidden');
});

// Kısayol seçici
function $(sel){return document.querySelector(sel);}
</script>
</body>
</html>
